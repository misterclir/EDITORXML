<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MU Online Bag Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Sidebar -->
    <aside class="sidebar" aria-label="Navegação">
        <div class="p-6 flex items-center gap-3 mb-6">
            <div class="w-8 h-8 bg-indigo-500 rounded-lg flex items-center justify-center">
                <i class="fa-solid fa-gem text-white"></i>
            </div>
            <h1 class="font-bold text-xl tracking-wide">MUDevs</h1>
        </div>

        <nav class="flex-1 px-4 space-y-2">
            <button id="navBagEditor" type="button" class="sidebar-link active">
                <i class="fa-solid fa-layer-group"></i>
                <span>Bag Editor</span>
            </button>
            <button id="navSettings" type="button" class="sidebar-link">
                <i class="fa-solid fa-gear"></i>
                <span>Settings</span>
            </button>
        </nav>

        <div class="p-4 border-t border-gray-700">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-gray-400">
                    <i class="fa-solid fa-user"></i>
                </div>
                <div>
                    <p class="text-sm font-medium text-white">Admin</p>
                    <p class="text-xs text-gray-500">MUDevs Team</p>
                </div>
            </div>
        </div>
    </aside>

    <div id="sidebarOverlay" class="sidebar-overlay" aria-hidden="true"></div>

    <!-- Main Content -->
    <main class="main-content">
        
        <!-- Top Bar -->
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center gap-4">
                <button id="sidebarToggleBtn" type="button" class="w-10 h-10 rounded-lg bg-gray-700 hover:bg-gray-600 flex items-center justify-center text-gray-200" aria-label="Alternar menu">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <div>
                    <h2 id="pageTitle" class="text-3xl font-bold text-white mb-1">Event Bag Editor</h2>
                    <p id="pageSubtitle" class="text-gray-400 text-sm">Gerencie drops e configurações de bags facilmente.</p>
                </div>
            </div>
            <div class="flex gap-4">
                <button id="downloadButton" class="btn-primary flex items-center gap-2">
                    <i class="fa-solid fa-download"></i> Baixar XML
                </button>
            </div>
        </header>

        <section id="pageEditor">

        <!-- Status & Upload -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Upload Card -->
            <div class="card col-span-2 relative overflow-hidden group">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="text-lg font-semibold text-white">Carregar Arquivo</h3>
                        <p class="text-sm text-gray-400">Suporta Common e EX Bags (.xml)</p>
                    </div>
                    <div class="p-2 bg-indigo-500/20 rounded-lg text-indigo-400">
                        <i class="fa-solid fa-upload"></i>
                    </div>
                </div>
                
                <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-600 rounded-lg cursor-pointer hover:border-indigo-500 hover:bg-gray-800 transition-colors">
                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                        <i class="fa-solid fa-cloud-arrow-up text-2xl text-gray-400 mb-2"></i>
                        <p class="text-sm text-gray-400">Clique para selecionar ou arraste</p>
                    </div>
                    <input type="file" id="uploadBag" accept=".xml" class="hidden" />
                </label>
                
                <div id="bagStatus" class="mt-4 text-sm font-medium"></div>
                <div id="loadingBag" class="hidden items-center mt-2 text-indigo-400 text-sm">
                    <i class="fa-solid fa-spinner fa-spin mr-2"></i> Processando...
                </div>
            </div>

            <!-- Stats Card -->
            <div class="card bg-gradient-to-br from-gray-800 to-gray-900">
                <h3 class="text-lg font-semibold text-white mb-4">Estatísticas</h3>
                <div class="space-y-4">
                    <div class="flex justify-between items-center p-3 bg-gray-800/50 rounded-lg">
                        <span class="text-gray-400">Total Itens</span>
                        <span id="totalItemsCount" class="text-xl font-bold text-white">0</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-800/50 rounded-lg">
                        <span class="text-gray-400">Tipo Bag</span>
                        <span id="currentBagType" class="text-sm font-bold text-indigo-400">-</span>
                    </div>
                    <div id="itemListStatus" class="text-xs text-gray-500 mt-2">Aguardando Item.xml...</div>
                </div>
            </div>
        </div>

        <!-- Configurations -->
        <div id="sectionOldConfig" class="card hidden">
            <div class="flex items-center gap-2 mb-6 border-b border-gray-700 pb-4">
                <i class="fa-solid fa-sliders text-indigo-400"></i>
                <h3 class="text-xl font-semibold text-white">Configurações Gerais (Common)</h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1">Name</label>
                    <input type="text" id="bagName" class="w-full px-3 py-2">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1">DropZen</label>
                    <input type="number" id="dropZen" class="w-full px-3 py-2">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1">ItemDropRate</label>
                    <input type="number" id="itemDropRate" class="w-full px-3 py-2">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1">ItemDropCount</label>
                    <input type="number" id="itemDropCount" class="w-full px-3 py-2">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1">SetItemDropRate</label>
                    <input type="number" id="setItemDropRate" class="w-full px-3 py-2">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1">ItemDropType</label>
                    <input type="number" id="itemDropType" class="w-full px-3 py-2">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1">Fireworks</label>
                    <select id="fireworks" class="w-full px-3 py-2">
                        <option value="0">0</option>
                        <option value="1">1</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="sectionNewConfig" class="card hidden">
             <div class="flex items-center gap-2 mb-6 border-b border-gray-700 pb-4">
                <i class="fa-solid fa-sliders text-purple-400"></i>
                <h3 class="text-xl font-semibold text-white">Configurações EX (New)</h3>
            </div>
            
            <div class="mb-8">
                <h4 class="text-sm font-bold text-gray-300 mb-4 uppercase tracking-wider">BagConfigEx</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1">Index</label>
                        <input type="number" id="configExIndex" class="w-full px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1">DropRate</label>
                        <input type="number" id="configExDropRate" class="w-full px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1">EqualAttributes</label>
                        <input type="number" id="configExEqualAttr" class="w-full px-3 py-2">
                    </div>
                </div>
            </div>

            <div class="mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-sm font-bold text-gray-300 uppercase tracking-wider">Drop Info List</h4>
                    <button id="addDropInfoBtn" class="text-xs btn-secondary flex items-center gap-2">
                        <i class="fa-solid fa-plus"></i> Add DropInfo
                    </button>
                </div>
                <div id="dropInfoContainer" class="space-y-4"></div>
            </div>

            <div>
                <h4 class="text-sm font-bold text-gray-300 mb-4 uppercase tracking-wider">Ruud Info</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1">Section</label>
                        <input type="number" id="ruudSection" class="w-full px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1">RuudMin</label>
                        <input type="number" id="ruudMin" class="w-full px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1">RuudMax</label>
                        <input type="number" id="ruudMax" class="w-full px-3 py-2">
                    </div>
                </div>
            </div>
        </div>

        <!-- Items Table -->
        <div class="card">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gray-700 rounded-lg">
                        <i class="fa-solid fa-list text-gray-300"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-white">Itens da Bag</h3>
                </div>
                <div class="flex gap-2">
                     <button id="addButton" class="btn-primary text-sm flex items-center gap-2">
                        <i class="fa-solid fa-plus"></i> Novo Item
                    </button>
                </div>
            </div>

            <div id="bulkEditBar" class="hidden mb-4 p-3 rounded-lg border border-gray-700 bg-gray-900/40 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                <div class="text-sm text-gray-300">
                    <span id="bulkSelectedCount" class="font-bold text-white">0</span> itens selecionados
                </div>
                <div class="flex flex-wrap gap-2">
                    <button id="bulkEditOpenBtn" class="btn-secondary text-xs flex items-center gap-2">
                        <i class="fa-solid fa-pen-to-square"></i> Editar em Massa
                    </button>
                    <button id="bulkClearSelectionBtn" class="btn-secondary text-xs flex items-center gap-2">
                        <i class="fa-solid fa-xmark"></i> Limpar Seleção
                    </button>
                </div>
            </div>

            <div>
                <div id="itemsTableScrollTop" class="table-scroll-top hidden" aria-hidden="true">
                    <div id="itemsTableScrollTopInner" class="table-scroll-top-inner"></div>
                </div>

                <div id="itemsTableScroll" class="overflow-x-auto table-scroll-bottom">
                    <table id="itemsTable">
                        <thead>
                            <tr id="headerRow">
                                <!-- JS Injected Headers -->
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-800">
                            <!-- Items -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pagination -->
            <div id="paginationControls" class="flex justify-center items-center mt-6 pt-4 border-t border-gray-700">
                <!-- JS Injected Pagination -->
            </div>
        </div>

        <div id="bulkEditModal" class="fixed inset-0 z-50 hidden flex items-center justify-center">
            <div class="modal-overlay absolute inset-0" onclick="closeBulkEditModal()"></div>
            <div class="modal-content relative bg-gray-800 p-6 rounded-xl w-[980px] max-w-[95vw] max-h-[85vh] overflow-hidden flex flex-col">
                <div class="flex items-start justify-between gap-4 border-b border-gray-700 pb-4">
                    <div>
                        <h3 class="text-xl font-bold text-white">Editar em Massa</h3>
                        <p class="text-xs text-gray-400 mt-1">Preencha apenas os campos que deseja aplicar. Campos vazios não alteram nada.</p>
                    </div>
                    <button onclick="closeBulkEditModal()" class="text-gray-400 hover:text-white">
                        <i class="fa-solid fa-times text-xl"></i>
                    </button>
                </div>

                <div class="py-4 flex flex-col gap-4 overflow-y-auto">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <label class="flex items-center gap-2 text-sm text-gray-300 bg-gray-900/40 border border-gray-700 rounded-lg px-3 py-2 cursor-pointer">
                            <input type="radio" name="bulkTarget" value="selected" checked class="rounded bg-gray-700 border-gray-600 text-indigo-500 focus:ring-indigo-500">
                            Itens selecionados
                        </label>
                        <label class="flex items-center gap-2 text-sm text-gray-300 bg-gray-900/40 border border-gray-700 rounded-lg px-3 py-2 cursor-pointer">
                            <input type="radio" name="bulkTarget" value="page" class="rounded bg-gray-700 border-gray-600 text-indigo-500 focus:ring-indigo-500">
                            Itens da página
                        </label>
                        <label class="flex items-center gap-2 text-sm text-gray-300 bg-gray-900/40 border border-gray-700 rounded-lg px-3 py-2 cursor-pointer">
                            <input type="radio" name="bulkTarget" value="all" class="rounded bg-gray-700 border-gray-600 text-indigo-500 focus:ring-indigo-500">
                            Todos os itens
                        </label>
                    </div>

                    <div id="bulkFields" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>

                <div class="pt-4 border-t border-gray-700 flex justify-end gap-2">
                    <button id="bulkCancelBtn" class="btn-secondary text-sm">Cancelar</button>
                    <button id="bulkApplyBtn" class="btn-primary text-sm">Aplicar</button>
                </div>
            </div>
        </div>
        </section>

        <section id="pageSettings" class="hidden">
            <div class="card">
                <div class="flex items-center gap-3 mb-6 border-b border-gray-700 pb-4">
                    <i class="fa-solid fa-file-lines text-indigo-400"></i>
                    <div>
                        <h3 class="text-xl font-semibold text-white">Item.xml</h3>
                        <p class="text-xs text-gray-400 mt-1">Envie uma vez e o editor mantém em cache neste navegador.</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-600 rounded-lg cursor-pointer hover:border-indigo-500 hover:bg-gray-800 transition-colors">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                <i class="fa-solid fa-cloud-arrow-up text-2xl text-gray-400 mb-2"></i>
                                <p class="text-sm text-gray-400">Clique para enviar o Item.xml</p>
                                <p class="text-xs text-gray-500 mt-1">Somente .xml</p>
                            </div>
                            <input type="file" id="uploadItemXml" accept=".xml" class="hidden" />
                        </label>
                        <div id="settingsItemXmlStatus" class="mt-4 text-sm"></div>
                    </div>

                    <div class="space-y-3">
                        <div class="p-4 rounded-lg border border-gray-700 bg-gray-900/40">
                            <div class="text-sm text-gray-300 font-semibold">Cache</div>
                            <div class="text-xs text-gray-500 mt-1">Use para reenviar outro Item.xml quando necessário.</div>
                            <div class="mt-3 flex flex-wrap gap-2">
                                <button id="clearItemXmlCacheBtn" type="button" class="btn-secondary text-sm flex items-center gap-2">
                                    <i class="fa-solid fa-trash"></i> Apagar Item.xml
                                </button>
                            </div>
                        </div>
                        <div class="p-4 rounded-lg border border-gray-700 bg-gray-900/40">
                            <div class="text-xs text-gray-500">Dica</div>
                            <div class="text-sm text-gray-300 mt-1">Sem Item.xml, o seletor de itens não abre e os nomes podem ficar genéricos.</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Modal Item Selector -->
    <div id="itemSelectorModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeItemSelector()"></div>
        <div class="modal-content absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[900px] h-[600px] rounded-xl flex overflow-hidden">
            
            <!-- Sections Sidebar -->
            <div class="w-64 section-list overflow-y-auto" id="selectorSectionList">
                <div class="p-4 border-b border-gray-700 font-bold text-white bg-gray-800">
                    Categorias
                </div>
                <!-- JS Injected Sections -->
            </div>

            <!-- Items Grid -->
            <div class="flex-1 flex flex-col bg-gray-900">
                <div class="p-4 border-b border-gray-700 flex justify-between items-center bg-gray-800">
                    <h3 class="font-bold text-white" id="selectorTitle">Selecione uma Categoria</h3>
                    <input type="text" id="itemSearch" placeholder="Buscar item..." class="w-64 px-3 py-1.5 text-sm bg-gray-700 border-gray-600 rounded-lg">
                    <button onclick="closeItemSelector()" class="text-gray-400 hover:text-white">
                        <i class="fa-solid fa-times text-xl"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-4" id="selectorItemGrid">
                    <div class="text-center text-gray-500 mt-20">
                        <i class="fa-solid fa-arrow-left mb-2"></i>
                        <p>Escolha uma categoria ao lado</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Modal Add Type -->
    <div id="addModal" class="fixed inset-0 z-50 hidden flex items-center justify-center">
        <div class="modal-overlay absolute inset-0" onclick="closeModal()"></div>
        <div class="modal-content relative bg-gray-800 p-8 rounded-xl max-w-md w-full">
            <h3 class="text-xl font-bold mb-6 text-white">Adicionar Item</h3>
            <div class="space-y-3">
                <button onclick="addCommonItem()" class="w-full p-4 bg-gray-700 hover:bg-gray-600 rounded-lg flex items-center gap-4 transition-colors text-left group">
                    <div class="w-10 h-10 rounded-full bg-blue-500/20 text-blue-400 flex items-center justify-center group-hover:bg-blue-500 group-hover:text-white">
                        <i class="fa-solid fa-shield-halved"></i>
                    </div>
                    <div>
                        <div class="font-bold text-white">Item Único</div>
                        <div class="text-xs text-gray-400">Adicionar um item vazio padrão</div>
                    </div>
                </button>

                <div class="p-4 bg-gray-700/50 rounded-lg border border-gray-700">
                    <label class="block text-xs font-bold text-purple-400 mb-2 uppercase">Adicionar Set Completo</label>
                    <select id="setHelmetSelect" class="w-full mb-3 text-sm"></select>
                    <button onclick="addFullSet()" class="w-full py-2 btn-primary text-sm">
                        Confirmar Set
                    </button>
                </div>
            </div>
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
